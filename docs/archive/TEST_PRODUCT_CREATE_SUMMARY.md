# โ ููุฎุต ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุงูููุชุฌ - ุฌุงูุฒ ููุงุฎุชุจุงุฑ

## ๐ ุงูุชุญูู ุงูููุงุฆู

### โ ุฌููุน ุงูุชุนุฏููุงุช ููุชููุฉ:

1. **โ Worker Endpoint (`/secure/merchant/store`):**
   - ูุณุชุนูู ูุจุงุดุฑุฉ ูู Supabase
   - ูุณุชุฎุฏู ุงูุณูููุง ุงูุตุญูุญุฉ: `auth.users.id = stores.owner_id`
   - ูุนูุฏ `{ ok: true, data: null }` ุฅุฐุง ูู ููุฌุฏ ูุชุฌุฑ

2. **โ StoreSession Provider:**
   - ููุฌูุฏ ูู `lib/core/session/store_session.dart`
   - ูุณุฌู ูู MultiProvider
   - ูุชู ุชุนุจุฆุชู ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู

3. **โ ุฌูุจ ุงููุชุฌุฑ:**
   - ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู: `root_widget.dart`
   - ุนูุฏ ุงูุฏุฎูู ูุดุงุดุฉ ุงูุชุงุฌุฑ: `merchant_home_screen.dart`

4. **โ ุฅุถุงูุฉ ุงูููุชุฌ:**
   - ูุณุชุฎุฏู `StoreSession.storeId`
   - ูุฑุณู `store_id` ูู body
   - ูุฑุณู `stock` (ูุทุงุจู ุงูุณูููุง)
   - Edge Function ุชุชุญูู ูู `store_id`

---

## ๐ ุงูููุงุท ุงููููุฉ ููุงุฎุชุจุงุฑ

### 1. ุงูุชุญูู ูู StoreSession:

```dart
// ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
final storeSession = context.read<StoreSession>();
print('Store ID: ${storeSession.storeId}'); // ูุฌุจ ุฃู ูููู ููุฌูุฏ
print('Has Store: ${storeSession.hasStore}'); // ูุฌุจ ุฃู ูููู true
```

### 2. ุจูุงูุงุช ุงูููุชุฌ ุงููุฑุณูุฉ:

```dart
{
  'store_id': storeId,           // โ ูู StoreSession
  'name': 'ููุชุฌ ุชุฌุฑูุจู',
  'description': 'ูุตู',
  'price': 100.0,
  'stock': 10,                   // โ ูุทุงุจู ุงูุณูููุง
  'status': 'active',
  'is_active': true
}
```

### 3. Edge Function ุชุชููุน:

```typescript
{
  user_id: string,               // โ ููุถุงู ุชููุงุฆูุงู
  store_id?: string,             // โ ูู Flutter
  name: string,
  description?: string,
  price: number,
  stock?: number,                // โ ูุทุงุจู ุงูุณูููุง
  status?: string,
  is_active?: boolean
}
```

---

## ๐งช ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ

### ุงูุฎุทูุฉ 1: ุชุณุฌูู ุงูุฏุฎูู
1. โ ุงูุชุญ ุงูุชุทุจูู
2. โ ุณุฌู ุงูุฏุฎูู ูุชุงุฌุฑ ูุฏูู ูุชุฌุฑ
3. โ ุชุญูู ูู console: ูุฌุจ ุฃู ุชุฑู:
   ```
   โ ุชู ุญูุธ Store ID ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู: <store_id>
   ```

### ุงูุฎุทูุฉ 2: ูุชุญ ุดุงุดุฉ ุงูููุชุฌุงุช
1. โ ุงูุชุญ ุดุงุดุฉ ุงูุชุงุฌุฑ
2. โ ุงูุชุญ ุดุงุดุฉ ุงูููุชุฌุงุช
3. โ ุงุถุบุท ุนูู "ุฅุถุงูุฉ ููุชุฌ"

### ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ููุชุฌ
1. โ ุงููุฃ ุงููููุฐุฌ:
   - ุงุณู: "ููุชุฌ ุชุฌุฑูุจู"
   - ุงููุตู: "ูุฐุง ููุชุฌ ููุงุฎุชุจุงุฑ"
   - ุงูุณุนุฑ: "100"
   - ุงููููุฉ: "10"
2. โ (ุงุฎุชูุงุฑู) ุงุฎุชุฑ ุตูุฑุฉ
3. โ ุงุถุบุท "ุฅุถุงูุฉ"

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุชูุฌุฉ
1. โ ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ูุฌุงุญ:
   ```
   "ุชู ุฅุถุงูุฉ ุงูููุชุฌ ุจูุฌุงุญ!"
   ```
2. โ ูุฌุจ ุฃู ูุธูุฑ ุงูููุชุฌ ูู ุงููุงุฆูุฉ
3. โ ุชุญูู ูู console: ูุฌุจ ุฃู ุชุฑู:
   ```
   ๐ฆ ุจูุงูุงุช ุงูููุชุฌ: {...}
   โ ุชู ุฅูุดุงุก ุงูููุชุฌ: {...}
   ```

---

## ๐ ุงูุฃุฎุทุงุก ุงููุญุชููุฉ

### ุฎุทุฃ 1: "ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชุฌุฑ"

**ุงูุญู:**
```dart
// ุชุญูู ูู StoreSession
final storeSession = context.read<StoreSession>();
if (!storeSession.hasStore) {
  // ูุฌุจ ุฅูุดุงุก ูุชุฌุฑ ุฃููุงู
}
```

### ุฎุทุฃ 2: "Store not found or access denied"

**ุงูุญู:**
- ุชุญูู ูู ุฃู `store_id` ุตุญูุญ
- ุชุญูู ูู ุฃู `stores.owner_id` ูุทุงุจู `auth.users.id`

### ุฎุทุฃ 3: "Missing required fields"

**ุงูุญู:**
- ุชุฃูุฏ ูู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ:
  - `name`
  - `price`
  - `stock`

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูุณุฑูุนุฉ

- [ ] ุชุณุฌูู ุงูุฏุฎูู ูุชุงุฌุฑ
- [ ] StoreSession.storeId ููุฌูุฏ
- [ ] ูุชุญ ุดุงุดุฉ ุงูููุชุฌุงุช
- [ ] ุฅุฏุฎุงู ุจูุงูุงุช ุงูููุชุฌ
- [ ] ุงูุถุบุท ุนูู "ุฅุถุงูุฉ"
- [ ] ุฑุณุงูุฉ ูุฌุงุญ ุชุธูุฑ
- [ ] ุงูููุชุฌ ูุธูุฑ ูู ุงููุงุฆูุฉ
- [ ] ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู console

---

## ๐ ุงููููุงุช ุงููุฑุชุจุทุฉ

### Backend:
- `mbuy-worker/src/index.ts` - Worker endpoint
- `mbuy-backend/functions/product_create/index.ts` - Edge Function

### Flutter:
- `lib/core/session/store_session.dart` - StoreSession Provider
- `lib/core/root_widget.dart` - ุฌูุจ store_id ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
- `lib/features/merchant/presentation/screens/merchant_home_screen.dart` - ุฌูุจ store_id
- `lib/features/merchant/presentation/screens/merchant_products_screen.dart` - ุฅุถุงูุฉ ุงูููุชุฌ

---

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ุงูุงุฎุชุจุงุฑ ุงููุงุฌุญ:

1. โ ุฑุณุงูุฉ ูุฌุงุญ ูู Flutter
2. โ ุงูููุชุฌ ูุธูุฑ ูู ูุงุฆูุฉ ุงูููุชุฌุงุช
3. โ ุงูููุชุฌ ูุญููุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ `store_id` ุตุญูุญ ููุทุงุจู
5. โ ุฌููุน ุงูุญููู ูุญููุธุฉ ุจุดูู ุตุญูุญ

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** ููุงูุฑ 2025  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ  
**ุงูุชุทุงุจู:** โ ููุชูู

---

## ๐ ููุงุญุธุงุช

- โ ุฌููุน ุงูุญููู ูุชุทุงุจูุฉ ุจูู Flutter ู Edge Function
- โ ุงูุณูููุง ุตุญูุญุฉ: `stock` (ูููุณ `stock_quantity`)
- โ ุงูุชุญูู ูู `store_id` ููุฌูุฏ
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงููุฉ

**ุฌุงูุฒ ููุงุฎุชุจุงุฑ ุงูุขู! ๐**

