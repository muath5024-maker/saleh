# ๐งช ุฏููู ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุงูููุชุฌ

## โ ุงูุชุญูู ูู ุงูุชุทุงุจู ุจูู Flutter ู Edge Function

### 1. ุงูุจูุงูุงุช ุงููุฑุณูุฉ ูู Flutter:

```dart
final productData = {
  'store_id': storeId,           // โ ูู StoreSession
  'name': _nameController.text.trim(),
  'description': _descriptionController.text.trim(),
  'price': double.parse(_priceController.text),
  'stock': int.parse(_stockController.text),  // โ ูุทุงุจู ุงูุณูููุง
  'status': 'active',
  'is_active': true,
  'main_image_url': imageUrl,    // ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
  'images': [imageUrl],          // ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
};
```

### 2. ุงูุจูุงูุงุช ุงููุชููุนุฉ ูู Edge Function:

```typescript
interface ProductCreateRequest {
  user_id: string;              // โ ูุถุงู ุชููุงุฆูุงู ูู Worker
  store_id?: string;            // โ ููุฑุณู ูู Flutter
  name: string;                 // โ
  description?: string;         // โ
  price: number;                // โ
  stock?: number;               // โ ูุทุงุจู ุงูุณูููุง (products.stock)
  stock_quantity?: number;      // โ ููุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ
  status?: string;              // โ
  is_active?: boolean;          // โ
  main_image_url?: string;      // โ
  images?: string[];            // โ
}
```

### 3. ุงูุญููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (products table):

```sql
- store_id UUID              โ
- name TEXT                  โ
- description TEXT           โ
- price DECIMAL(10, 2)       โ
- stock INTEGER              โ (ูุณุชุฎุฏู stock ูููุณ stock_quantity)
- status TEXT                โ
- main_image_url TEXT        โ
- image_url TEXT             โ (ููููุฃ ูู main_image_url ุชููุงุฆูุงู)
```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

### 1. ูู Flutter (`merchant_products_screen.dart`):

1. โ ุงูุชุญูู ูู ูุฌูุฏ `store_id` ูู `StoreSession`
2. โ ุฑูุน ุงูุตูุฑุฉ (ุฅุฐุง ูุงูุช ููุฌูุฏุฉ) ุนุจุฑ `ApiService.uploadImage()`
3. โ ุฅุนุฏุงุฏ ุจูุงูุงุช ุงูููุชุฌ
4. โ ุฅุฑุณุงู ุงูุทูุจ ุนุจุฑ `ApiService.post('/secure/products', data: productData)`

### 2. ูู Worker (`src/index.ts`):

1. โ ุงุณุชุฎุฑุงุฌ `userId` ูู JWT
2. โ ุฅุถุงูุฉ `user_id` ุฅูู body
3. โ ุชูุฑูุฑ ุงูุทูุจ ุฅูู Edge Function

### 3. ูู Edge Function (`product_create/index.ts`):

1. โ ุงูุชุญูู ูู Internal Key
2. โ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู body
3. โ ุงูุชุญูู ูู ุฃู `store_id` ูุฎุต `user_id` (ุฅุฐุง ุชู ุฅุฑุณุงูู)
4. โ ุฅุถุงูุฉ ุงูููุชุฌ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
5. โ ุฅุฑุฌุงุน ุงูููุชุฌ ุงููููุดุฃ

---

## ๐ ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุงููุฏูู

### ุงููุชุทูุจุงุช:
- ุญุณุงุจ ุชุงุฌุฑ ูุณุฌู ุงูุฏุฎูู
- ูุชุฌุฑ ููุฌูุฏ ููุจุงุฆุน
- ุชุทุจูู Flutter ูุนูู

### ุงูุฎุทูุงุช:

1. **ุชุณุฌูู ุงูุฏุฎูู ูุชุงุฌุฑ:**
   - โ ุงูุชุญูู ูู ุฃู `StoreSession.storeId` ุชู ุชุนุจุฆุชู

2. **ูุชุญ ุดุงุดุฉ ุงูููุชุฌุงุช:**
   - โ ุงูููุฑ ุนูู "ุฅุถุงูุฉ ููุชุฌ"
   - โ ููุก ุงููููุฐุฌ:
     - ุงุณู ุงูููุชุฌ: "ููุชุฌ ุชุฌุฑูุจู"
     - ุงููุตู: "ูุตู ุงูููุชุฌ"
     - ุงูุณุนุฑ: "100"
     - ุงููููุฉ: "10"
     - (ุงุฎุชูุงุฑู) ุงุฎุชูุงุฑ ุตูุฑุฉ

3. **ุฅุฑุณุงู ุงููููุฐุฌ:**
   - โ ุงูููุฑ ุนูู "ุฅุถุงูุฉ"
   - โ ุงูุชุญูู ูู:
     - ุธููุฑ ุฑุณุงูุฉ ูุฌุงุญ
     - ุธููุฑ ุงูููุชุฌ ูู ุงููุงุฆูุฉ
     - ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ูู console

### 4. **ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**

```sql
SELECT 
  id, 
  store_id, 
  name, 
  price, 
  stock, 
  status, 
  is_active,
  main_image_url,
  created_at
FROM products
WHERE store_id = '<store_id>'
ORDER BY created_at DESC
LIMIT 1;
```

---

## ๐ ุงูุฃุฎุทุงุก ุงููุญุชููุฉ ูุญููููุง

### 1. ุฎุทุฃ: "ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชุฌุฑ"

**ุงูุณุจุจ:**
- `StoreSession.storeId` ูุงุฑุบ

**ุงูุญู:**
- ุงูุชุญูู ูู ุฃู ุงููุชุฌุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงูุชุญูู ูู ุฃู `GET /secure/merchant/store` ูุนูุฏ ุงููุชุฌุฑ
- ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุชุงุฌุฑ

### 2. ุฎุทุฃ: "Store not found or access denied"

**ุงูุณุจุจ:**
- `store_id` ุงูููุฑุณู ูุง ูุฎุต ุงููุณุชุฎุฏู

**ุงูุญู:**
- ุงูุชุญูู ูู ุฃู `store_id` ูู `StoreSession` ุตุญูุญ
- ุงูุชุญูู ูู ุฃู `stores.owner_id` ูุทุงุจู `auth.users.id`

### 3. ุฎุทุฃ: "Missing required fields"

**ุงูุณุจุจ:**
- ุญูู ูุทููุจ ููููุฏ

**ุงูุญู:**
- ุงูุชุญูู ูู ุฃู ุฌููุน ุงูุญููู ุงููุทููุจุฉ ููููุกุฉ:
  - `name`
  - `price`
  - `stock`

### 4. ุฎุทุฃ: "Failed to create product"

**ุงูุณุจุจ:**
- ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุดููุฉ ูู ุงูุณูููุง

**ุงูุญู:**
- ุงูุชุญูู ูู logs ูู Edge Function
- ุงูุชุญูู ูู ุฃู ุฌุฏูู `products` ููุฌูุฏ
- ุงูุชุญูู ูู ุฃู `store_id` ุตุญูุญ

---

## โ ูุงุฆูุฉ ุงูุชุญูู

### ูุจู ุงูุงุฎุชุจุงุฑ:

- [ ] ุชุณุฌูู ุงูุฏุฎูู ูุชุงุฌุฑ
- [ ] ุงูุชุญูู ูู ูุฌูุฏ ูุชุฌุฑ
- [ ] ูุชุญ ุดุงุดุฉ ุงูููุชุฌุงุช
- [ ] ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ูู console

### ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ:

- [ ] ุฅุฏุฎุงู ุงุณู ุงูููุชุฌ
- [ ] ุฅุฏุฎุงู ุงููุตู
- [ ] ุฅุฏุฎุงู ุงูุณุนุฑ
- [ ] ุฅุฏุฎุงู ุงููููุฉ
- [ ] (ุงุฎุชูุงุฑู) ุงุฎุชูุงุฑ ุตูุฑุฉ
- [ ] ุงูููุฑ ุนูู "ุฅุถุงูุฉ"
- [ ] ุงูุชุญูู ูู ุฑุณุงูุฉ ุงููุฌุงุญ

### ุจุนุฏ ุงูุงุฎุชุจุงุฑ:

- [ ] ุงูุชุญูู ูู ุธููุฑ ุงูููุชุฌ ูู ุงููุงุฆูุฉ
- [ ] ุงูุชุญูู ูู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ูู console

---

## ๐ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ุงูููุชุฑุญุฉ

### ููุชุฌ ุชุฌุฑูุจู 1 (ุจุฏูู ุตูุฑุฉ):

```json
{
  "name": "ููุชุฌ ุชุฌุฑูุจู 1",
  "description": "ูุฐุง ููุชุฌ ููุงุฎุชุจุงุฑ",
  "price": 99.99,
  "stock": 50,
  "status": "active",
  "is_active": true
}
```

### ููุชุฌ ุชุฌุฑูุจู 2 (ูุน ุตูุฑุฉ):

```json
{
  "name": "ููุชุฌ ุชุฌุฑูุจู 2",
  "description": "ููุชุฌ ูุน ุตูุฑุฉ ููุงุฎุชุจุงุฑ",
  "price": 149.50,
  "stock": 25,
  "status": "active",
  "is_active": true,
  "main_image_url": "https://...",
  "images": ["https://..."]
}
```

---

## ๐ Debug Points

### ูู Flutter:

```dart
debugPrint('๐ฆ ุจูุงูุงุช ุงูููุชุฌ: $productData');
debugPrint('โ ุชู ุฅูุดุงุก ุงูููุชุฌ: $result');
```

### ูู Worker:

```typescript
console.log('Creating product for user:', userId);
console.log('Product data:', body);
```

### ูู Edge Function:

```typescript
console.log('Product creation request:', body);
console.log('Store ID:', storeId);
console.log('Created product:', product);
```

---

## โ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ุฅุถุงูุฉ ุงูููุชุฌ ุจูุฌุงุญ:

1. โ ุฑุณุงูุฉ ูุฌุงุญ ูู Flutter
2. โ ุงูููุชุฌ ูุธูุฑ ูู ูุงุฆูุฉ ุงูููุชุฌุงุช
3. โ ุงูููุชุฌ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ `store_id` ุตุญูุญ ููุทุงุจู ูุชุฌุฑ ุงููุณุชุฎุฏู
5. โ ุฌููุน ุงูุญููู ูุญููุธุฉ ุจุดูู ุตุญูุญ

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** ููุงูุฑ 2025  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ

