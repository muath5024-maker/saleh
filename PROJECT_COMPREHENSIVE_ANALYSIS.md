# ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù…Ø´Ø±ÙˆØ¹ MBUY

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:** 2025-01-07  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 1.0.0

---

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
2. [Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©](#Ø§Ù„Ø¨Ù†ÙŠØ©-Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©)
3. [Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©](#Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª-Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
4. [Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª](#Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª-ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª)
5. [Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª](#Ù‚Ø§Ø¹Ø¯Ø©-Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
6. [Ø§Ù„Ø£Ù…Ø§Ù†](#Ø§Ù„Ø£Ù…Ø§Ù†)
7. [Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©](#Ù†Ù‚Ø§Ø·-Ø§Ù„Ù‚ÙˆØ©)
8. [Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†](#Ù†Ù‚Ø§Ø·-Ø§Ù„ØªØ­Ø³ÙŠÙ†)
9. [Ø§Ù„ØªÙˆØµÙŠØ§Øª](#Ø§Ù„ØªÙˆØµÙŠØ§Øª)
10. [Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©](#Ø§Ù„Ø®Ø·Ø©-Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©)

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

### ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
**MBUY** Ù‡Ùˆ ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø§Ø±Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„ ÙŠØ¯Ø¹Ù…:
- **ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„**: ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ Ø§Ù„Ù…Ø­ÙØ¸Ø©ØŒ Ø§Ù„Ù†Ù‚Ø§Ø·
- **ÙˆØ¶Ø¹ Ø§Ù„ØªØ§Ø¬Ø±**: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±ØŒ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª

### Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
- **Frontend**: Flutter (Dart) - ØªØ·Ø¨ÙŠÙ‚ Ù…ÙˆØ¨Ø§ÙŠÙ„
- **Backend**: Cloudflare Workers (TypeScript) - API Gateway
- **Database**: Supabase (PostgreSQL) - Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª
- **Authentication**: Ù†Ø¸Ø§Ù… Ù…Ø®ØµØµ (mbuy_users + JWT)
- **Storage**: Cloudflare Images, R2 - ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª
- **AI**: Google Gemini - Ù…ÙŠØ²Ø§Øª Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ

---

## ğŸ—ï¸ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

### Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ù‚ÙŠØ©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Flutter App   â”‚
â”‚   (saleh/lib)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTPS + JWT
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare      â”‚
â”‚ Worker          â”‚
â”‚ (mbuy-worker)   â”‚
â”‚                 â”‚
â”‚ â€¢ Auth Handler  â”‚
â”‚ â€¢ JWT Middlewareâ”‚
â”‚ â€¢ API Gateway   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ SERVICE_ROLE_KEY
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase      â”‚
â”‚   PostgreSQL    â”‚
â”‚                 â”‚
â”‚ â€¢ mbuy_users    â”‚
â”‚ â€¢ mbuy_sessions â”‚
â”‚ â€¢ products      â”‚
â”‚ â€¢ stores        â”‚
â”‚ â€¢ orders        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ø§Ù„Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

1. **API Gateway Pattern**: Worker ÙƒÙˆØ§Ø¬Ù‡Ø© ÙˆØ­ÙŠØ¯Ø© Ù„Ù„Ù€ APIs
2. **Custom Auth**: Ù†Ø¸Ø§Ù… Ù…ØµØ§Ø¯Ù‚Ø© Ù…Ø®ØµØµ Ø¨Ø¯ÙˆÙ† Supabase Auth
3. **JWT-based Security**: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ© Ø¨Ù€ JWT
4. **Service Role Access**: Worker ÙŠØ³ØªØ®Ø¯Ù… SERVICE_ROLE_KEY ÙÙ‚Ø·
5. **Separation of Concerns**: ÙØµÙ„ ÙˆØ§Ø¶Ø­ Ø¨ÙŠÙ† Frontend Ùˆ Backend

---

## ğŸ§© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### 1. Flutter Application (saleh/)

#### Ø§Ù„Ø¨Ù†ÙŠØ©:
```
saleh/lib/
â”œâ”€â”€ core/                    # Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
â”‚   â”œâ”€â”€ services/           # API Service, Auth Repository
â”‚   â”œâ”€â”€ theme/              # Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†
â”‚   â”œâ”€â”€ widgets/            # Widgets Ù…Ø´ØªØ±ÙƒØ©
â”‚   â””â”€â”€ root_widget.dart    # Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
â”‚
â”œâ”€â”€ features/               # Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
â”‚   â”œâ”€â”€ auth/              # Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
â”‚   â”œâ”€â”€ customer/          # ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
â”‚   â”œâ”€â”€ merchant/          # ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ§Ø¬Ø±
â”‚   â””â”€â”€ shared/            # Ù…ÙŠØ²Ø§Øª Ù…Ø´ØªØ±ÙƒØ©
â”‚
â””â”€â”€ shared/                # Ù…ÙƒÙˆÙ†Ø§Øª Ù…Ø´ØªØ±ÙƒØ©
    â””â”€â”€ widgets/           # Widgets Ù‚Ø§Ø¨Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
```

#### Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:
- âœ… **Auth System**: ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„/ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¹Ø¨Ø± Worker
- âœ… **Customer Mode**: ØªØµÙØ­ØŒ Ø·Ù„Ø¨Ø§ØªØŒ Ù…Ø­ÙØ¸Ø©ØŒ Ù†Ù‚Ø§Ø·
- âœ… **Merchant Mode**: Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ…ØŒ Ù…Ù†ØªØ¬Ø§ØªØŒ Ø·Ù„Ø¨Ø§ØªØŒ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
- âœ… **Dual Mode**: Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ§Ø¬Ø±
- âœ… **RTL Support**: Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©

#### Ø§Ù„Ø­Ø§Ù„Ø©:
- âœ… **Auth**: ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ø¹Ø¨Ø± Worker
- âœ… **API Integration**: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªÙ…Ø± Ø¹Ø¨Ø± Worker
- âš ï¸ **Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª**: Ù„Ø§ ØªØ²Ø§Ù„ ØªØ³ØªØ®Ø¯Ù… Supabase Ù…Ø¨Ø§Ø´Ø±Ø© (ØºÙŠØ± Ø­Ø±Ø¬Ø©)

### 2. Cloudflare Worker (mbuy-worker/)

#### Ø§Ù„Ø¨Ù†ÙŠØ©:
```
mbuy-worker/src/
â”œâ”€â”€ index.ts               # Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (3831 Ø³Ø·Ø±)
â”œâ”€â”€ endpoints/             # API Endpoints
â”‚   â””â”€â”€ auth.ts           # Auth handlers
â”œâ”€â”€ middleware/            # Middlewares
â”‚   â”œâ”€â”€ authMiddleware.ts # JWT verification
â”‚   â””â”€â”€ rateLimiter.ts    # Rate limiting
â”œâ”€â”€ utils/                 # Utilities
â”‚   â”œâ”€â”€ supabase.ts      # Supabase client helper
â”‚   â””â”€â”€ auth.ts          # JWT & password hashing
â””â”€â”€ types.ts              # TypeScript types
```

#### Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:
- **Total Endpoints**: ~104 endpoint
- **Auth Endpoints**: 4 (register, login, me, logout)
- **Secure Endpoints**: ~100+ Ù…Ø­Ù…ÙŠØ© Ø¨Ù€ JWT middleware
- **Public Endpoints**: ~10 (products, stores, categories)

#### Ø§Ù„Ù…ÙŠØ²Ø§Øª:
- âœ… **Custom Auth**: mbuy_users + mbuy_sessions + JWT
- âœ… **JWT Middleware**: Ø­Ù…Ø§ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ `/secure/*` routes
- âœ… **Supabase Integration**: Ø§Ø³ØªØ®Ø¯Ø§Ù… SERVICE_ROLE_KEY
- âœ… **Rate Limiting**: Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø¥ÙØ±Ø§Ø· ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
- âœ… **Error Handling**: Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
- âœ… **CORS**: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª CORS Ù…Ø­Ø³Ù†Ø©

### 3. Supabase Database

#### Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:

**Auth Tables:**
- `mbuy_users`: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† (id, email, password_hash, full_name, phone, is_active)
- `mbuy_sessions`: Ø§Ù„Ø¬Ù„Ø³Ø§Øª (id, user_id, token_hash, expires_at, is_active)

**Business Tables:**
- `user_profiles`: Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (id, role, display_name, avatar_url)
- `stores`: Ø§Ù„Ù…ØªØ§Ø¬Ø± (id, name, owner_id, city, status)
- `products`: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (id, name, price, store_id, category_id)
- `orders`: Ø§Ù„Ø·Ù„Ø¨Ø§Øª (id, customer_id, store_id, status, total)
- `wallets`: Ø§Ù„Ù…Ø­Ø§ÙØ¸ (id, user_id, balance)
- `points_accounts`: Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø· (id, user_id, balance)

#### RLS Policies:
- âœ… Service Role: ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
- âœ… mbuy_users/mbuy_sessions: Ù…Ø­Ù…ÙŠØ© Ø¨Ù€ RLS Ù…Ø¹ Service Role access

---

## ğŸ”„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª

### 1. ØªØ¯ÙÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„

```
User Input (Email + Password)
    â†“
Flutter: AuthRepository.login()
    â†“
POST /auth/login (Worker)
    â†“
Worker: Verify credentials in mbuy_users
    â†“
Worker: Create session in mbuy_sessions
    â†“
Worker: Generate JWT token
    â†“
Response: { ok: true, user: {...}, token: "..." }
    â†“
Flutter: Save token in secure storage
    â†“
Flutter: Call /auth/me to verify
    â†“
Flutter: Navigate to Home/Dashboard
```

### 2. ØªØ¯ÙÙ‚ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ (ØªØ§Ø¬Ø±)

```
Merchant: Fill product form
    â†“
Flutter: POST /secure/products
    â†“
Worker: JWT Middleware verifies token
    â†“
Worker: Extract userId from JWT
    â†“
Worker: Fetch store from stores table (owner_id = userId)
    â†“
Worker: Clean body (remove id, store_id, user_id)
    â†“
Worker: Insert product with store_id
    â†“
Response: { ok: true, data: {...} }
    â†“
Flutter: Update UI
```

### 3. ØªØ¯ÙÙ‚ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨

```
Customer: Add products to cart
    â†“
Flutter: POST /secure/orders/create-from-cart
    â†“
Worker: Verify JWT
    â†“
Worker: Get cart items
    â†“
Worker: Create order
    â†“
Worker: Update inventory
    â†“
Worker: Send notifications
    â†“
Response: { ok: true, data: {...} }
```

---

## ğŸ—„ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### Schema Overview

#### Auth Schema:
```sql
mbuy_users
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ email (TEXT, UNIQUE)
â”œâ”€â”€ password_hash (TEXT)
â”œâ”€â”€ full_name (TEXT)
â”œâ”€â”€ phone (TEXT)
â”œâ”€â”€ is_active (BOOLEAN)
â””â”€â”€ created_at, updated_at (TIMESTAMPTZ)

mbuy_sessions
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ mbuy_users)
â”œâ”€â”€ token_hash (TEXT)
â”œâ”€â”€ user_agent (TEXT)
â”œâ”€â”€ ip_address (TEXT)
â”œâ”€â”€ expires_at (TIMESTAMPTZ)
â””â”€â”€ is_active (BOOLEAN)
```

#### Business Schema:
- **user_profiles**: Ø±Ø¨Ø· Ù…Ø¹ mbuy_users Ø¹Ø¨Ø± mbuy_user_id
- **stores**: Ø±Ø¨Ø· Ù…Ø¹ mbuy_users Ø¹Ø¨Ø± mbuy_owner_id
- **products**: Ø±Ø¨Ø· Ù…Ø¹ stores Ø¹Ø¨Ø± store_id
- **orders**: Ø±Ø¨Ø· Ù…Ø¹ user_profiles Ùˆ stores

### Indexes:
- âœ… Email lookups ÙÙŠ mbuy_users
- âœ… User sessions ÙÙŠ mbuy_sessions
- âœ… Store lookups ÙÙŠ stores
- âœ… Product queries ÙÙŠ products

---

## ğŸ”’ Ø§Ù„Ø£Ù…Ø§Ù†

### Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†:

1. **Authentication Layer**:
   - âœ… JWT tokens Ù…Ø¹ expiration (30 ÙŠÙˆÙ…)
   - âœ… Password hashing Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… PBKDF2 (100,000 rounds)
   - âœ… Session tracking ÙÙŠ mbuy_sessions

2. **Authorization Layer**:
   - âœ… JWT Middleware Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ `/secure/*` routes
   - âœ… User ID extraction Ù…Ù† JWT payload
   - âœ… Store ownership verification

3. **Data Protection**:
   - âœ… SERVICE_ROLE_KEY Ù…Ø­Ù…ÙŠ ÙÙŠ Worker secrets
   - âœ… Client Ù„Ø§ ÙŠØ±Ø³Ù„ user_id, store_id, owner_id
   - âœ… Body cleaning ÙÙŠ Worker Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬

4. **Network Security**:
   - âœ… HTTPS ÙÙ‚Ø·
   - âœ… CORS policies Ù…Ø­Ø¯Ø¯Ø©
   - âœ… Rate limiting

### Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:
- âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ Supabase Auth ÙÙŠ Flutter
- âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© Ù…Ø­Ù…ÙŠØ© Ø¨Ù€ JWT
- âœ… Worker ÙŠØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†:
- âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø§ ØªØ²Ø§Ù„ ØªØ³ØªØ®Ø¯Ù… Supabase Ù…Ø¨Ø§Ø´Ø±Ø©
- âš ï¸ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© refresh tokens
- âš ï¸ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© 2FA

---

## ğŸ’ª Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©

### 1. Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©
- âœ… **API Gateway Pattern**: ÙØµÙ„ ÙˆØ§Ø¶Ø­ Ø¨ÙŠÙ† Frontend Ùˆ Backend
- âœ… **Custom Auth**: ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
- âœ… **Scalability**: Cloudflare Workers Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙˆØ³Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- âœ… **Security**: Ø·Ø¨Ù‚Ø§Øª Ø£Ù…Ø§Ù† Ù…ØªØ¹Ø¯Ø¯Ø©

### 2. Ø§Ù„ÙƒÙˆØ¯
- âœ… **Type Safety**: TypeScript ÙÙŠ Worker, Dart ÙÙŠ Flutter
- âœ… **Error Handling**: Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
- âœ… **Code Organization**: Ø¨Ù†ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ù†Ø¸Ù…Ø©
- âœ… **Documentation**: ØªÙˆØ«ÙŠÙ‚ Ø¬ÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª

### 3. Ø§Ù„Ù…ÙŠØ²Ø§Øª
- âœ… **Dual Mode**: Ø¯Ø¹Ù… ÙˆØ¶Ø¹ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ§Ø¬Ø±
- âœ… **RTL Support**: Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
- âœ… **Real-time**: Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¶Ø§ÙØ© real-time features
- âœ… **AI Integration**: Ø¯Ø¹Ù… Google Gemini

---

## âš ï¸ Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†

### 1. Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Supabase Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ²Ø§Ù„ ØªØ³ØªØ®Ø¯Ù… Supabase Ù…Ø¨Ø§Ø´Ø±Ø©:**
- `order_status_service.dart`
- `order_service.dart`
- `merchant_points_service.dart`
- `coupon_service.dart`
- `category_products_screen.dart`
- `store_details_screen.dart`

**Ø§Ù„ØªØ£Ø«ÙŠØ±:** Ù…Ù†Ø®ÙØ¶ (ØºÙŠØ± Ø­Ø±Ø¬Ø©)

**Ø§Ù„Ø­Ù„:** Ø¥Ù†Ø´Ø§Ø¡ API endpoints ÙÙŠ Worker ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª

### 2. Worker Edge Functions

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø¨Ø¹Ø¶ Ø§Ù„Ù€ endpoints ØªØ³ØªØ¯Ø¹ÙŠ Edge Functions Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Supabase Ù…Ø¨Ø§Ø´Ø±Ø©
- `/secure/products` â†’ ÙŠØ³ØªØ¯Ø¹ÙŠ Edge Function

**Ø§Ù„ØªØ£Ø«ÙŠØ±:** Ù…ØªÙˆØ³Ø· (ÙŠØ¹Ù…Ù„ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡)

**Ø§Ù„Ø­Ù„:** ØªØ­Ø¯ÙŠØ« Worker Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Supabase Ù…Ø¨Ø§Ø´Ø±Ø©

### 3. Error Handling

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙƒØ§ÙÙŠØ©

**Ø§Ù„Ø­Ù„:** ØªØ­Ø³ÙŠÙ† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ ÙˆØ¥Ø¶Ø§ÙØ© error codes Ù…ÙˆØ­Ø¯Ø©

### 4. Testing

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ù„Ø§ ØªÙˆØ¬Ø¯ tests ÙˆØ§Ø¶Ø­Ø©

**Ø§Ù„Ø­Ù„:** Ø¥Ø¶Ø§ÙØ© unit tests Ùˆ integration tests

### 5. Documentation

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…ÙƒØ±Ø±Ø©

**Ø§Ù„Ø­Ù„:** ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙÙŠ Ù…Ù„ÙØ§Øª Ø±Ø¦ÙŠØ³ÙŠØ©

---

## ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª

### Ø§Ù„ÙƒÙˆØ¯:
- **Flutter**: ~50+ Ù…Ù„Ù Dart
- **Worker**: ~3831 Ø³Ø·Ø± ÙÙŠ index.ts
- **Endpoints**: ~104 endpoint
- **Database Tables**: ~20+ Ø¬Ø¯ÙˆÙ„

### Ø§Ù„Ù…ÙŠØ²Ø§Øª:
- âœ… Auth: 4 endpoints
- âœ… Products: ~10 endpoints
- âœ… Orders: ~8 endpoints
- âœ… Stores: ~5 endpoints
- âœ… Wallet/Points: ~6 endpoints
- âœ… Analytics: ~3 endpoints

### Ø§Ù„Ø£Ù…Ø§Ù†:
- âœ… JWT Protection: 100+ endpoint
- âœ… Rate Limiting: Ù…ÙØ¹Ù„
- âœ… CORS: Ù…Ø­Ø¯ÙˆØ¯
- âœ… Password Hashing: PBKDF2

---

## ğŸ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª

### Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©:

1. **Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Supabase Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©**
   - Ø¥Ù†Ø´Ø§Ø¡ API endpoints ÙÙŠ Worker
   - ØªØ­Ø¯ÙŠØ« Flutter services
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 2-3 Ø£ÙŠØ§Ù…

2. **ØªØ­Ø³ÙŠÙ† Error Handling**
   - ØªÙˆØ­ÙŠØ¯ error codes
   - ØªØ­Ø³ÙŠÙ† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 1 ÙŠÙˆÙ…

3. **Ø¥Ø¶Ø§ÙØ© Tests**
   - Unit tests Ù„Ù„Ù€ Worker
   - Integration tests Ù„Ù„Ù€ Flutter
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 3-5 Ø£ÙŠØ§Ù…

### Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©:

4. **ØªØ­Ø³ÙŠÙ† Worker Performance**
   - Caching Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
   - Optimize database queries
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 2-3 Ø£ÙŠØ§Ù…

5. **Ø¥Ø¶Ø§ÙØ© Monitoring**
   - Error tracking (Sentry)
   - Performance monitoring
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 1-2 Ø£ÙŠØ§Ù…

6. **ØªØ­Ø³ÙŠÙ† Documentation**
   - ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙˆØ«ÙŠÙ‚
   - Ø¥Ø¶Ø§ÙØ© API documentation
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 2-3 Ø£ÙŠØ§Ù…

### Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©:

7. **Ø¥Ø¶Ø§ÙØ© Refresh Tokens**
   - ØªØ­Ø³ÙŠÙ† Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ù„Ø³Ø§Øª
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 1-2 Ø£ÙŠØ§Ù…

8. **Ø¥Ø¶Ø§ÙØ© 2FA**
   - ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ù…Ø§Ù†
   - **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 3-5 Ø£ÙŠØ§Ù…

---

## ğŸš€ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± (Ø£Ø³Ø¨ÙˆØ¹ 1-2)
- âœ… Ø¥ÙƒÙ…Ø§Ù„ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©
- â³ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Supabase Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
- â³ ØªØ­Ø³ÙŠÙ† Error Handling

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„ØªØ­Ø³ÙŠÙ† (Ø£Ø³Ø¨ÙˆØ¹ 3-4)
- â³ Ø¥Ø¶Ø§ÙØ© Tests
- â³ ØªØ­Ø³ÙŠÙ† Performance
- â³ Ø¥Ø¶Ø§ÙØ© Monitoring

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø´Ù‡Ø± 2)
- â³ Real-time notifications
- â³ Advanced analytics
- â³ AI-powered features

---

## ğŸ“ Ø§Ù„Ø®Ù„Ø§ØµØ©

### Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:
- âœ… **Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©**: Ù…Ø­Ø¯Ø«Ø© ÙˆÙ…Ø³ØªÙ‚Ø±Ø©
- âœ… **Ø§Ù„Ø£Ù…Ø§Ù†**: Ù‚ÙˆÙŠ ÙˆÙ…Ø­Ù…ÙŠ
- âœ… **Ø§Ù„Ù…ÙŠØ²Ø§Øª**: ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
- âš ï¸ **Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª**: Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†

### Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…:
- **Ø§Ù„Ø£Ù…Ø§Ù†**: â­â­â­â­â­ (5/5)
- **Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©**: â­â­â­â­â­ (5/5)
- **Ø§Ù„ÙƒÙˆØ¯**: â­â­â­â­ (4/5)
- **Ø§Ù„ØªÙˆØ«ÙŠÙ‚**: â­â­â­ (3/5)
- **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª**: â­â­ (2/5)

### Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: â­â­â­â­ (4/5)

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:** 2025-01-07  
**Ø§Ù„Ù…Ø­Ù„Ù„:** AI Assistant  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ù…ÙƒØªÙ…Ù„

